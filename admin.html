<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Sankat Saathi Seva Foundation</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand text-white" href="index.html">
                <i class="fas fa-arrow-left me-2"></i>Back to Website
            </a>
            
            <div class="navbar-nav ms-auto">
                <div class="admin-dashboardd" style="display: none;">
                    <span class="navbar-text text-white me-3">
                        <i class="fas fa-user-shield me-1"></i>Admin Panel
                    </span>
                    <button class="btn btn-outline-light btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-1"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>
 
    <!-- Edit modal -->
    <div class="modal fade" id="editBlogModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title">Edit Blog</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <input type="hidden" id="editBlogId">

        <div class="mb-3">
          <label class="form-label">Title</label>
          <input type="text" id="editBlogTitle" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Author</label>
          <input type="text" id="editBlogAuthor" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Category</label>
          <select id="editBlogCategory" class="form-select">
            <option value="impact-stories">Impact Stories</option>
            <option value="news">News</option>
            <option value="programs">Programs</option>
            <option value="events">Events</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Featured Image URL</label>
          <input type="text" id="editBlogImage" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Content</label>
          <div id="editBlogContent" class="form-control" style="min-height:150px;" contenteditable="true"></div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="updateBlog()">Update Blog</button>
      </div>

    </div>
  </div>
</div>


    <!-- Admin Section -->
    <section class="admin-section">
        <div class="container">
            <!-- Login Form -->
            <div class="admin-login">
                <div class="text-center mb-4">
                    <i class="fas fa-user-shield fa-3x text-primary mb-3"></i>
                    <h2 class="fw-bold">Admin Login</h2>
                    <p class="text-muted">Please login to manage blog content</p>
                </div>
                
                <form id="adminLoginForm">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" required>
                        <small class="form-text text-muted">Default: admin</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" required>
                        <small class="form-text text-muted">Default: admin123</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-sign-in-alt me-1"></i>Login
                    </button>
                </form>
            </div>


        </div>
    </section>

<div class="container-fluid admin-dashboard-container py-4 px-lg-5 bg-white ">
    <!-- Admin Dashboard -->
    <div class="admin-dashboard" style="display:none;">

<div>
        <!-- Blog Management -->
<div class="mb-0">
    <h2 class="fw-bold mb-4 text-primary text-center">
        <i class="fas fa-blog me-2"></i>Blog Management
    </h2>

    <div class="row">
        <!-- LEFT: Blog Creation Form -->
        <div class="col-lg-6 col-md-12">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <h4 class="fw-bold mb-3 text-secondary">Create New Blog Post</h4>

                    <form id="blogForm">
                        <div class="row g-3">
                            <div class="col-lg-8 col-md-12">
                                <label for="blogTitle" class="form-label">Blog Title *</label>
                                <input type="text" class="form-control" placeholder="Blog Title" id="blogTitle" required>

                            </div>
                            <div class="col-lg-4 col-md-6">
                                <label for="blogCategory" class="form-label">Category</label>
                                <select class="form-select" id="blogCategory">
                                    <option value="impact-stories">Impact Stories</option>
                                    <option value="news">News</option>
                                    <option value="programs">Programs</option>
                                    <option value="events">Events</option>
                                </select>
                            </div>
                            <!-- <div class="col-12">
    <label for="blogHeading" class="form-label">Heading</label>
    <input type="text" class="form-control" id="blogHeading" placeholder="Enter heading for the blog" />
</div> -->

                            <div class="col-lg-6 col-md-6">
                                <label for="blogAuthor" class="form-label" >Author *</label>
                                <input type="text" class="form-control" placeholder="Author Name" id="blogAuthor" required>
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <label for="blogImage" class="form-label">Featured Image URL</label>
                                <!-- <input type="url" class="form-control" id="blogImage" placeholder="https://example.com/image.jpg">
                                <small class="text-muted">Leave empty to use default category image</small> -->
                                <input type="text" class="form-control" id="blogImage" name="image_url" placeholder="images/banner1.jpg">
                                <small class="text-muted">Leave empty to use default category image</small>


                            </div>
                            <div class="col-12">
                                <label for="blogContent" class="form-label">Content *</label>
                                <div class="editor-toolbar mb-2"></div>
                                <div id="blogContent" class="form-control" style="min-height: 200px; resize: vertical;"></div>
                                <small class="text-muted">Use the toolbar above to format your content</small>
                            </div>
                        </div>

                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-outline-secondary me-2" onclick="resetBlogForm()">
                                <i class="fas fa-undo me-1"></i>Reset
                            </button>
                            <button type="submit" class="btn btn-primary" id="publishBlog">
                                <i class="fas fa-paper-plane me-1"></i>Publish Blog
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- RIGHT: Existing Blogs -->
<div class="col-lg-6 col-md-12">
    <div class="card shadow-sm border-0">
        <div class="card-body d-flex flex-column">
            <!-- Card Header -->
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                <h4 class="fw-bold mb-0">Published Blogs</h4>
                <button class="btn btn-outline-primary btn-sm" onclick="loadBlogs()">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
            </div>

            <!-- Scrollable List Area -->
            <div id="blogsList" class="list-group flex-grow-1 overflow-auto">
                <!-- Blogs will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card shadow-sm border-0 mt-4">
        <div class="card-body">
            <h5 class="fw-bold mb-3">Quick Actions</h5>
            <div class="row">
                <div class="col-md-12 col-sm-6 mb-3">

                    <button class="btn btn-outline-info w-100" onclick="showStatistics()">
                        <i class="fas fa-chart-bar me-1"></i>View Statistics
                    </button>

                </div>
                <div class="col-md-12 col-sm-6 mb-3">
                    <button class="btn btn-outline-success w-100" onclick="exportBlogs()">
                        <i class="fas fa-download me-1"></i>Export Blogs
                    </button>
                </div>
                <div class="col-md-12 col-sm-6 mb-3">
    <a href="php/blogs.php" class="btn btn-outline-primary w-100">
        <i class="fas fa-eye me-1"></i>View Blogs
    </a>
</div>

                <div class="col-md-12 col-sm-6 ">
                    <a href="news-stories.php" class="btn btn-outline-primary w-100">
                        <i class="fas fa-eye me-1"></i>View News
                    </a>

                </div>
            </div>
        </div>
    </div>
</div>

    </div>
</div>

<div class="card shadow-sm border-0 mb-2">
  <div class="card-body">
    <div class="row g-4">
      
      <div class="col-lg-3 col-md-6">
        <div class="card bg-primary text-white h-60">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h6>Total Blogs</h6>
                <h2 id="totalBlogs">0</h2>
              </div>
              <div class="align-self-center">
                <i class="fas fa-blog fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="card bg-success text-white h-60">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h6>Published Today</h6>
                <h2 id="todayBlogs">0</h2>
              </div>
              <div class="align-self-center">
                <i class="fas fa-calendar-day fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="card bg-info text-white h-60">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h6>Impact Stories</h6>
                <h2 id="impactStories">0</h2>
              </div>
              <div class="align-self-center">
                <i class="fas fa-heart fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-3 col-md-6">
        <div class="card bg-warning text-white h-60">
          <div class="card-body">
            <div class="d-flex justify-content-between">
              <div>
                <h6>News Articles</h6>
                <h2 id="newsArticles">0</h2>
              </div>
              <div class="align-self-center">
                <i class="fas fa-newspaper fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div> <!-- END row -->
  </div> <!-- END card-body -->
</div> <!-- END outer card -->


        <!-- Quick Actions -->


</div>


    </div>
</div>







    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="js/main.js"></script>
    <script src="js/admin.js"></script>
    
    <script>
        // Additional admin functions
        // function updateStatistics() {
        //     const blogs = getBlogsFromStorage();
        //     const today = new Date().toDateString();
            
        //     document.getElementById('totalBlogs').textContent = blogs.length;
            
        //     const todayBlogs = blogs.filter(blog => 
        //         new Date(blog.publishDate).toDateString() === today
        //     ).length;
        //     document.getElementById('todayBlogs').textContent = todayBlogs;
            
        //     const impactStories = blogs.filter(blog => 
        //         blog.category === 'impact-stories'
        //     ).length;
        //     document.getElementById('impactStories').textContent = impactStories;
            
        //     const newsArticles = blogs.filter(blog => 
        //         blog.category === 'news'
        //     ).length;
        //     document.getElementById('newsArticles').textContent = newsArticles;
        // }
        
        // function exportBlogs() {
        //     const blogs = getBlogsFromStorage();
        //     const dataStr = JSON.stringify(blogs, null, 2);
        //     const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
        //     const link = document.createElement('a');
        //     link.href = URL.createObjectURL(dataBlob);
        //     link.download = `akshaya_patra_blogs_${new Date().toISOString().split('T')[0]}.json`;
        //     link.click();
            
        //     showAlert('Blogs exported successfully!', 'success');
        // }
        
        function exportBlogs() {
  window.location.href = 'php/export_blogs.php';
  showAlert('Export started. Check your downloads.', 'success');
}


        function backupBlogs() {
            const blogs = getBlogsFromStorage();
            const backupKey = `akshaya_patra_blogs_backup_${Date.now()}`;
            localStorage.setItem(backupKey, JSON.stringify(blogs));
            
            showAlert('Blogs backed up successfully!', 'success');
        }
function showStatistics() {
  fetch('php/get_blog_statistics.php')
    .then(res => res.json())
    .then(stats => {
      let statsHtml = `
        <div class="statistics-modal">
          <h4>Blog Statistics</h4>
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between">
              <span>Total Blogs:</span>
              <strong>${stats.total_blogs}</strong>
            </li>
      `;

      ['impact-stories', 'news', 'programs', 'events'].forEach(category => {
        const categoryName = category.split('_').map(word =>
          word.charAt(0).toUpperCase() + word.slice(1)
        ).join(' ');
        statsHtml += `
          <li class="list-group-item d-flex justify-content-between">
            <span>${categoryName}:</span>
            <strong>${stats[category]}</strong>
          </li>
        `;
      });

      statsHtml += '</ul></div>';

      const modal = document.createElement('div');
      modal.className = 'modal fade';
      modal.innerHTML = `
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Statistics</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              ${statsHtml}
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
      const bootstrapModal = new bootstrap.Modal(modal);
      bootstrapModal.show();

      modal.addEventListener('hidden.bs.modal', () => {
        document.body.removeChild(modal);
      });
    })
    .catch(err => console.error('Failed to load blog statistics:', err));
}

        // Update statistics when blogs are loaded
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(updateStatistics, 1000);
        });
        
        // Update statistics whenever blogs change
        const originalSaveBlog = saveBlog;
        saveBlog = function() {
            originalSaveBlog();
            setTimeout(updateStatistics, 100);
        };
    </script>
</body>
</html>
